drop database ChurchSys;
create database ChurchSys;


use ChurchSys;

CREATE TABLE Church (
	
	churchId int NOT NULL AUTO_INCREMENT ,
    
	churchName nvarchar(255),
    
	longTitude nvarchar(255),
    
	tel nvarchar(255),
    
	startTime DateTime ,
    
	endTime DateTime,
    
	description nvarchar (255),
    
	lateTitude nvarchar(255),

    	streamLink nvarchar(255),
	streamStatus int,
	PRIMARY KEY (churchId)

);


create table Manager (
	
	managerId int NOT NULL AUTO_INCREMENT,

   	accountId nvarchar(255),
 	password nvarchar (255),
 
	managerName nvarchar(255),  
 	churchId int,
    
	role varchar(50),
    
	tel nvarchar (20),
    
	certificate nvarchar(255),
	accountNum nvarchar(255),
	enabled bit,
    
	email nvarchar(255),
    
	primary key (managerId)

);
create table Ability (
	
	managerId int,
    
	subId int,
    
	abilityId int NOT NULL AUTO_INCREMENT,
    
	primary key (abilityId)

);

create table Subject (
	
	subId int NOT NULL AUTO_INCREMENT,
    
	subName nvarchar(255),
    
	categoryId int,
    
	primary key (subId)
   
 
);
create table Category(
	
	categoryId int NOT NULL AUTO_INCREMENT,
    
	categoryName nvarchar (255),
    
	primary key (categoryId)

);
create table Room (
	
	roomId int NOT NULL AUTO_INCREMENT,
    
	roomName nvarchar(50),
 
	churchId int,     
	roomStatus int,
    
	primary key(roomId)

);
create table Event(
	
	eventId int NOT NULL AUTO_INCREMENT,
    
	numOfSlot int,
	churchId int,
	eventStatus int,
	examDate date,
    
	subId int,
    
	typeId int,
    
	startDate date,
    
	primary key (eventId)

);
create table Type (
	
	typeId int NOT NULL AUTO_INCREMENT,
    
	description nvarchar(255),
    
	primary key (typeId)

);
create table Registration (
	
	regisId int NOT NULL AUTO_INCREMENT,
    
	eventId int,
    
	username nvarchar (255),
	churchId int,    
	subId int,
       
	regisDate date,
    
	estTime time,
    
	regisStatus int,
    
	result int,
    
	message nvarchar (255),
    
	primary key (regisId)

);
CREATE table Post (
	
	postId int NOT NULL AUTO_INCREMENT,
    
	managerId int,

	title nvarchar (255),    
	information nvarchar (255),
    
	isContribute bit,
    
	primary key (postId)

);
create table User (
	
	username nvarchar(255) NOT NULL,
    
	password nvarchar(255),
    
	tel nvarchar(50),
    
	mail nvarchar(255),
    
	primary key (userName)

);
create table Slot (
	
	slotId int NOT NULL AUTO_INCREMENT,
	
	eventId int,
    
	roomId int,
    
	managerId int,
    
	slotDate date,
    
	slotHour int,
    
    
	primary key (slotId)
    

);
create table Question (

	
	quesId int NOT NULL AUTO_INCREMENT,
    
	managerId int,
    
	username nvarchar(255),
    
	information nvarchar(255),
    
	quesStatus nvarchar(255),
	subId int,
    
    
	primary key (quesId)

);
create table Contribution(
	
	username nvarchar(255),
    
	postId int,
    
	contributeId int NOT NULL AUTO_INCREMENT,
    
	donate long,
    
    
	primary key (contributeId)

);
create table RoomCapable (
	
	roomId int,
    
	subId int,
  
	roomCapId int NOT NULL AUTO_INCREMENT,
    
    
	primary key (roomCapId)
    

);
alter table Manager 
add foreign key (churchId) references Church (churchId);

alter table Subject 
add foreign key (categoryId) references Category(categoryId);

alter table RoomCapable 
add foreign key (subId) references Subject(subId);

alter table RoomCapable
 add foreign key (roomId) references Room(roomId);

alter table Event 
add foreign key (subId) references Subject(subId);

alter table Event 
add foreign key (typeId) references type (typeId);


alter table Registration
 add foreign key (eventId) references Event(eventId);

alter table Registration 
add foreign key (subId) references Subject(subId);

alter table Registration 
add foreign key (userName) references User(userName);

alter table Question 
add foreign key (managerId) references Manager(managerId);

alter table Question 
add foreign key (userName) references User (userName);

alter table Post
add foreign key (managerId) references Manager(managerId);
alter table Contribution 
add foreign key (userName) references User (userName);

alter table Contribution 
add foreign key (postId) references Post(postId);

alter table Slot 
add foreign key (eventId) references Event(eventId);

alter table Slot 
add foreign key (roomId) references Room (roomId);

alter table Slot 
add foreign key (managerId) references Manager(managerId);

alter table Ability 
add foreign key (managerId) references Manager(managerId);

alter table Ability
 add foreign key (subId) references Subject(subId);
alter table Question add foreign key (subId) references Subject (subId);
alter table Room add foreign key (churchId) references Church(churchId);
alter table Registration add foreign key (churchId) references Church(churchId);
alter table Event add foreign key (churchId) references Church(churchId);



INSERT INTO Church(churchId,churchName ,longTitude, tel, startTime, endTime,description,lateTitude) 
VALUES (1,'ABC','aaa','0123456789','2010/5/31 ',' 3000/5/21',' Nha Tho DN','aaaa');
INSERT INTO Manager(accountId, managerName,password ,churchId ,role,tel ,certificate ,enabled ,email ) 
VALUES ('hungmc','Mai Cong Hung','$2a$06$PCHDLeLTWHrmQReSR3hCUeZTINjWfIDj7iRssodGt9iiWcAVWQbaC','1','ROLE_ADMIN','0904555555','adada',1,'email');

Insert into User(username,password,tel,mail)
values('hien','12345678','0123456789','hien@gmail.com');

Insert into User(username,password,tel,mail)
values('trung','12345678','0123456789','trung@gmail.com');

Insert into User(username,password,tel,mail)
values('Kiet','12345678','0123456789','hien@gmail.com');


Insert into Type(description)
values ('246');
Insert into Type(description)
values ('357');

insert into Category(categoryName)
values ('xinle');

insert into category(categoryName)
values ('lichconggiao');

insert into category( categoryName)
values ('dangkilopgiaoly');



insert into Subject(subName,categoryId)
values ('HonNhan',3);

insert into Subject(subName,categoryId)
values ('GiaoLy',3);


insert into Room(roomName,roomStatus,churchId)
values ('101',1,1);


insert into Room(roomName,roomStatus,churchId)
values ('102',1,1);

insert into Room(roomName,roomStatus,churchId)
values ('103',1,1);


insert into Event( numOfSlot,eventStatus,churchId,examDate,subId,StartDate,typeId)
values (12,1,1,'2017/7/7',1,'2017/6/3',1);


insert into Slot(eventId, roomId,managerId,slotDate,slotHour)
values (1,1,1,'2017/6/6',1);

insert into Slot(eventId, roomId,managerId,slotDate,slotHour)
values (1,2,1,'2017/6/6',1);


insert into RoomCapable(roomId,subId)
values (1,1);

insert into RoomCapable(roomId,subId)
values (2,2);


insert into Registration(username,subId,regisDate,churchId,estTime,regisStatus,result,message)
values('hien',1,'2017/6/1',1,3,1,1,'xyz');


insert into Ability(managerId, subId)
values(1,1);
insert into Ability(managerId,subId)
values(1,2);


insert into Question(managerId,username,information,quesStatus,subId)
values(1,'hien','dadada','dadadad',1);

insert into Question(managerId,username,information,quesStatus,subId)
values(1,'kiet','dadda','dadad',2);


insert into Post(managerId,title,information,isContribute)
values(1,'bietchetlien','dadwdawdwa',1);

insert into Post(managerId,title,information,isContribute)
values(1,'chucngungon','widowdw',1);


insert into Contribution(username,postId,donate)
values('hien',1,1000000);

insert into Contribution(username,postId,donate)
values('trung',2,100000000)
