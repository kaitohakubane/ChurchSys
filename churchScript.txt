create database ChurchSys;


use ChurchSys;

CREATE TABLE Church (
	
	churchId int  ,
    
	churchName nvarchar(255),
    
	longTitude nvarchar(255),
    
	tel nvarchar(255),
    
	startTime DateTime ,
    
	endTime DateTime,
    
	description nvarchar (255),
    
	lateTitude nvarchar(255),

    	streamLink nvarchar(255),
	streamStatus int,
	PRIMARY KEY (churchId)

);


create table Manager (
	
	managerId nvarchar(100) ,
   
 	password nvarchar (255),
   
 	churchId int,
    role int,
    
	tel nvarchar (20),
    
	certificate nvarchar(255),
	accountNum nvarchar(255),
	status int,
    
	email nvarchar(255),
    
	primary key (managerId)

);
create table Ability (
	
	managerId nvarchar(100),
    
	subId int,
    
	abilityId int,
    
	primary key (abilityId)

);

create table Subject (
	
	subId int,
    
	subName nvarchar(255),
    
	categoryId int,
    
	primary key (subId)
   
 
);
create table Category(
	
	categoryId int,
    
	catergoryName nvarchar (255),
    
	primary key (categoryId)

);
create table Room (
	
	roomId int,
    
	roomName nvarchar(50),
    
	roomStatus int,
    
	primary key(roomId)

);
create table Event(
	
	eventId int,
    
	numOfSlot int,
    
	eventStatus int,
    
	examDate date,
    
	subId int,
    
	typeId int,
    
	startDate date,
    
	primary key (eventId)

);
create table Type (
	
	typeId int,
    
	description nvarchar(255),
    
	primary key (typeId)

);
create table Registration (
	
	regisId int,
    
	eventId int,
    
	username nvarchar (255),
    
	subId int,
    
	managerId nvarchar(100),
    
	regisDate date,
    
	estTime time,
    
	regisStatus int,
    
	result int,
    
	message nvarchar (255),
    
	primary key (regisId)

);
CREATE table Post (
	
	postId int,
    
	managerId nvarchar(100),

	title nvarchar (255),    
	information nvarchar (255),
    
	isContribute bit,
    
	primary key (postId)

);
create table User (
	
	username nvarchar(255),
    
	password nvarchar(255),
    
	tel nvarchar(50),
    
	mail nvarchar(255),
    
	primary key (userName)

);
create table Slot (
	
	slotId int,
	
	eventId int,
    
	roomId int,
    
	managerId nvarchar(100),
    
	slotDate date,
    
	slotHour int,
    
    
	primary key (slotId)
    

);
create table Question (

	
	quesId int,
    
	managerId nvarchar(100),
    
	username nvarchar(255),
    
	information nvarchar(255),
    
	quesStatus nvarchar(255),
	subId int,
    
    
	primary key (quesId)

);
create table Contribution(
	
	username nvarchar(255),
    
	postId int,
    
	contributeId int,
    
	donate long,
    
    
	primary key (contributeId)

);
create table RoomCapable (
	
	roomId int,
    
	subId int,
    
	roomCapId int,
    
    
	primary key (roomCapId)
    

);
alter table Manager 
add foreign key (churchId) references Church (churchId);

alter table Subject 
add foreign key (categoryId) references Category(categoryId);

alter table RoomCapable 
add foreign key (subId) references Subject(subId);

alter table RoomCapable
 add foreign key (roomId) references Room(roomId);

alter table Event 
add foreign key (subId) references Subject(subId);

alter table Event 
add foreign key (typeId) references type (typeId);


alter table Registration
 add foreign key (eventId) references Event(eventId);

alter table Registration 
add foreign key (subId) references Subject(subId);

alter table Registration 
add foreign key (userName) references User(userName);

alter table Question 
add foreign key (managerId) references Manager(managerId);

alter table Question 
add foreign key (userName) references User (userName);

alter table Post
add foreign key (managerId) references Manager(managerId);
alter table Contribution 
add foreign key (userName) references User (userName);

alter table Contribution 
add foreign key (postId) references Post(postId);

alter table Slot 
add foreign key (eventId) references Event(eventId);

alter table Slot 
add foreign key (roomId) references Room (roomId);

alter table Slot 
add foreign key (managerId) references Manager(managerId);

alter table Ability 
add foreign key (managerId) references Manager(managerId);

alter table Ability
 add foreign key (subId) references Subject(subId);
alter table Question add foreign key (subId) references Subject (subId)