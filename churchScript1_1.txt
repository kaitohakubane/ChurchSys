drop database ChurchSys;
create database ChurchSys;


use ChurchSys;

CREATE TABLE Church (
	
	churchId int NOT NULL AUTO_INCREMENT ,
    
	churchName nvarchar(255),
    
	longtitude double,

	latetitude double,
    
	tel nvarchar(50),
    
	mail nvarchar(255),
	startTime DateTime ,
    
	endTime DateTime,
    
	description nvarchar (255),

    	streamLink nvarchar(255),
	streamStatus int,
	PRIMARY KEY (churchId)

);


create table User(
	
	userId int NOT NULL AUTO_INCREMENT,

   	accountId nvarchar(255),

 	password nvarchar (255),
 
	managerName nvarchar(255),  

 	churchId int,
    
	role varchar(50),
    
	tel nvarchar (20),
    
	certificate nvarchar(255),
	
	accountNum nvarchar(255),

	enabled bit,
    
	email nvarchar(255),
    
	primary key (userId)

);
create table Ability (
	
	userId int,
    
	subId int,
    
	abilityId int NOT NULL AUTO_INCREMENT,
    
	primary key (abilityId)

);

create table Subject (
	
	subId int NOT NULL AUTO_INCREMENT,
    
	subName nvarchar(255),
    
	categoryId int,
    
	primary key (subId)
   
 
);
create table Category(
	
	categoryId int NOT NULL AUTO_INCREMENT,
    
	categoryName nvarchar (255),
    
	primary key (categoryId)

);
create table Room (
	
	roomId int NOT NULL AUTO_INCREMENT,
    
	roomName nvarchar(50),
 
	churchId int,     
	roomStatus int,
    
	primary key(roomId)

);
create table Event(
	
	eventId int NOT NULL AUTO_INCREMENT,
    
	numOfSlot int,
	churchId int,
	eventStatus int,
	examDate date,
    
	subId int,
    
	typeId int,
    
	startDate date,
    
	primary key (eventId)

);
create table Type (
	
	typeId int NOT NULL AUTO_INCREMENT,
    
	description nvarchar(255),
    
	primary key (typeId)

);
create table Registration (
	
	regisId int NOT NULL AUTO_INCREMENT,
    
	eventId int,
    
	userId int,
	churchId int,    
	subId int,
       
	regisDate date,
    
	estTime time,
    
	regisStatus int,
    
	result int,
    
	message nvarchar (255),
    
	primary key (regisId)

);
CREATE table Post (
	
	postId int NOT NULL AUTO_INCREMENT,
    
	userId int,

	title nvarchar (255),    
	information nvarchar (255),
    
	isContribute bit,
    
	primary key (postId)

);
create table Slot (
	
	slotId int NOT NULL AUTO_INCREMENT,
	
	eventId int,
    
	roomId int,
    
	managerId int,
    
	slotDate date,
    
	slotHour int,
    
	primary key (slotId)
    

);
create table Question (

	
	quesId int NOT NULL AUTO_INCREMENT,
    
	conductorId int,
    
	userId int,
    
	information nvarchar(255),
    
	quesStatus nvarchar(255),
	subId int,
    
    
	primary key (quesId)

);
create table Contribution(
	
	userId int,
    
	postId int,
    
	contributeId int NOT NULL AUTO_INCREMENT,
    
	donate long,
    
    
	primary key (contributeId)

);
create table RoomCapable (
	
	roomId int,
    
	subId int,
  
	roomCapId int NOT NULL AUTO_INCREMENT,
    
    
	primary key (roomCapId)
    

);
alter table Subject 

add foreign key (categoryId) references Category(categoryId);


alter table RoomCapable 

add foreign key (subId) references Subject(subId);


alter table RoomCapable
 
add foreign key (roomId) references Room(roomId);


alter table Event 

add foreign key (subId) references Subject(subId);


alter table Event 

add foreign key (churchId) references church(churchId);


alter table Event 

add foreign key (typeId) references type (typeId);



alter table Registration
 
add foreign key (eventId) references Event(eventId);


alter table Registration 

add foreign key (subId) references Subject(subId);


alter table Registration 

add foreign key (userId) references User(userId);


alter table Question 

add foreign key (subId) references Subject (subId);



alter table Question 

add foreign key (userId) references User (userId);


alter table Post 

add foreign key (userId) references User(userId);

alter table Contribution 

add foreign key (userId) references User (userId);


alter table Contribution 

add foreign key (postId) references Post(postId);


alter table Slot 

add foreign key (eventId) references Event(eventId);


alter table Slot 

add foreign key (roomId) references Room (roomId);




alter table Ability 

add foreign key (userId) references User(userId);


alter table Ability
 
add foreign key (subId) references Subject(subId);
 


alter table Room 

add foreign key (churchId) references Church(churchId);




INSERT INTO Church(churchName ,longTitude, tel, startTime, endTime,description,lateTitude,streamLink,streamStatus) 

VALUES ('ABC',2242,'0123456789','2010/5/31 ',' 3000/5/21',' Nha Tho DN',3242,'dddddd',1);


insert into User(accountId,password,managerName,churchId,role,tel,certificate,accountNum ,enabled ,email) 

values ('hungmc','$2a$06$PCHDLeLTWHrmQReSR3hCUeZTINjWfIDj7iRssodGt9iiWcAVWQbaC','Mai Cong Hung',1,'ROLE_ADMIN','0904555555','dadad',1,1,'email');


insert into User(accountId,password,managerName,churchId,role,tel,certificate,accountNum ,enabled ,email) 

values ('kietTranAnh','$2a$06$PCHDLeLTWHrmQReSR3hCUeZTINjWfIDj7iRssodGt9iiWcAVWQbaC','Tran ANh Kiet',1,'ROLE_ADMIN','0904555555','dadad',1,1,'email');





Insert into Type(description)

values ('246');

Insert into Type(description)

values ('357');


insert into Category(categoryName)

values ('xinle');


insert into category(categoryName)

values ('lichconggiao');


insert into category( categoryName)

values ('dangkilopgiaoly');




insert into Subject(subName,categoryId)

values ('HonNhan',3);


insert into Subject(subName,categoryId)

values ('GiaoLy',3);



insert into Room(roomName,roomStatus,churchId)

values ('101',1,1);



insert into Room(roomName,roomStatus,churchId)

values ('102',1,1);


insert into Room(roomName,roomStatus,churchId)

values ('103',1,1);



insert into Event( numOfSlot,eventStatus,churchId,examDate,subId,typeId,StartDate)

values (12,1,1,'2017/7/7',1,1,'2017/6/3');



insert into Slot(eventId, roomId,managerId,slotDate,slotHour)

values (1,1,1,'2017/6/6',1);


insert into Slot(eventId, roomId,managerId,slotDate,slotHour)

values (1,2,1,'2017/6/6',1);



insert into RoomCapable(roomId,subId)

values (1,1);



insert into RoomCapable(roomId,subId)

values (2,2);
insert into Registration(eventId,userId,churchId,subId,regisDate,estTime,regisStatus,result,message)

values(1,1,1,1,'2017/6/1',1,3,1,'xyz');



insert into Ability(userId, subId)
values(1,1);
insert into Ability(userId,subId)

values(1,2);



insert into Question(conductorId,userId,information,quesStatus,subId)

values(1,1,'dadada','dadadad',1);


insert into Question(conductorId,userId,information,quesStatus,subId)

values(2,'2','dadda','dadad',2);



insert into Post(userId,title,information,isContribute)

values(1,'bietchetlien','dadwdawdwa',1);


insert into Post(userId,title,information,isContribute)

values(2,'chucngungon','widowdw',1);



insert into Contribution(userId,postId,donate)

values(1,1,1000000);


insert into Contribution(userId,postId,donate)

values(2,2,100000000)
